<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; font-src 'self'; script-src 'self'; connect-src *;">
  <link rel="stylesheet" href="./node_modules/katex/dist/katex.min.css">
  <link rel="stylesheet" href="styles.css">
  <title>LaTeXOCR - Windows</title>
</head>
<body>
  <div class="app">
    <header class="app-header">
      <div>
        <div class="title">LaTeXOCR · Windows 便携版</div>
        <div class="subtitle">Electron 重制 · Ctrl+Shift+A 直接截图识别</div>
      </div>
      <div class="pill" id="copy-format-pill">自动复制：LaTeX</div>
    </header>

    <div class="action-row">
      <div class="action-buttons">
        <button class="btn ghost" id="btn-select-image">选择图片</button>
        <button class="btn ghost" id="btn-screenshot">截图识别 (Ctrl+Shift+A)</button>
        <button class="btn primary" id="btn-convert">转换公式</button>
      </div>
      <div class="status-line" id="status-line">等待图片或截图…</div>
    </div>

    <div class="grid">
      <section class="panel">
        <div class="panel-head">
          <span>识别图片</span>
          <span class="hint">可拖动截图区域</span>
        </div>
        <div id="image-preview" class="preview empty">
          <div class="placeholder">暂无图片</div>
        </div>
      </section>

      <section class="panel">
        <div class="panel-head">
          <span>公式预览</span>
          <span class="hint">KaTeX + MathML</span>
        </div>
        <div class="katex-wrapper">
          <div id="katex-output" aria-live="polite"></div>
          <div class="loading-mask" id="loading-mask" hidden>
            <div class="spinner"></div>
            <div class="loading-text">识别中…</div>
          </div>
        </div>
      </section>

      <section class="panel">
        <div class="panel-head">
          <span>结果 / 复制</span>
          <span class="hint" id="result-hint">等待识别…</span>
        </div>
        <div class="result-actions">
          <button class="btn ghost" id="btn-copy-latex">复制 LaTeX</button>
          <button class="btn ghost" id="btn-copy-mathml">复制 MathML (Word)</button>
        </div>
        <textarea id="latex-output" spellcheck="false" placeholder="公式文本将显示在这里"></textarea>
        <div class="mathml-row">
          <div class="mathml-label">MathML 摘要</div>
          <div class="mathml-preview" id="mathml-preview">暂无</div>
        </div>
      </section>

      <section class="panel">
        <div class="panel-head">
          <span>API 设置</span>
          <span class="hint">自动保存</span>
        </div>
        <form id="settings-form" class="settings">
          <label class="field">
            <span>API 地址</span>
            <input type="text" id="api-base" placeholder="https://your-host/v1/chat/completions" autocomplete="off">
          </label>
          <label class="field">
            <span>API Key</span>
            <input type="password" id="api-key" placeholder="sk-..." autocomplete="off">
          </label>
          <label class="field">
            <span>模型</span>
            <select id="api-model">
              <option value="gpt-5.2">gpt-5.2</option>
              <option value="gpt-4.1-mini">gpt-4.1-mini</option>
              <option value="其他">其他</option>
            </select>
          </label>
          <label class="field" id="custom-model-field" hidden>
            <span>自定义模型</span>
            <input type="text" id="api-model-custom" placeholder="输入模型名称" autocomplete="off">
          </label>
          <label class="field">
            <span>自动复制格式</span>
            <select id="copy-format">
              <option value="latex">LaTeX</option>
              <option value="mathml">MathML (Word)</option>
            </select>
          </label>
          <div class="help">配置与 macOS 版保持一致：OpenAI 兼容接口 + Bearer Token。</div>
        </form>
      </section>
    </div>
  </div>

  <script src="./node_modules/katex/dist/katex.min.js"></script>
  <script defer src="renderer.js"></script>
</body>
</html>
